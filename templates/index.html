<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Performance Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="range"] {
            padding: 0;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        #chart {
            margin-top: 20px;
            width: 100%;
            height: 300px;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Portfolio Performance Calculator</h1>
        <div class="input-group">
            <label for="initialPortfolio">Initial Portfolio Value:</label>
            <input type="number" id="initialPortfolio" value="100">
        </div>
        <div class="input-group">
            <label for="risk">Risk (%):</label>
            <input type="range" id="risk" min="1" max="20" value="5">
            <input type="number" id="riskValue" value="5" min="1" max="20">
        </div>
        <div class="input-group">
            <label for="riskRewardRatio">Reward/Risk Ratio:</label>
            <input type="range" id="riskRewardRatio" min="0.5" max="5" step="0.1" value="2">
            <input type="number" id="riskRewardValue" value="2" min="0.5" max="5" step="0.1">
        </div>
        <div class="input-group">
            <label for="winProbability">Win Probability (%):</label>
            <input type="range" id="winProbability" min="1" max="99" value="70">
            <input type="number" id="winProbabilityValue" value="70" min="1" max="99">
            <small style="display: block; color: #666;">Note: Win rates below 50% typically result in portfolio decline</small>
        </div>
        <div class="input-group">
            <label for="riskFreeRate">Risk-Free Rate (%):</label>
            <input type="number" id="riskFreeRate" value="5" min="0" max="20">
        </div>

        <div class="input-group">
            <label for="tradesPerPeriod">Trades per Day:</label>
            <input type="number" id="tradesPerPeriod" value="5" min="1" max="50">
            <small style="display: block; color: #666;">Average number of trades you make per day</small>
        </div>
        <div class="input-group">
            <label for="simulations">Number of Simulations:</label>
            <input type="number" id="simulations" value="100" min="1" max="1000">
            <small style="display: block; color: #666;">More simulations = more accurate average</small>
        </div>
        <button onclick="runSimulation()">Calculate</button>
        <div class="result">
            <h3>Results:</h3>
            <p>Average Portfolio Increase: $<span id="averageResult">-</span></p>
            <p>Best Case: $<span id="bestCase">-</span></p>
            <p>Worst Case: $<span id="worstCase">-</span></p>
            <p>Sharpe Ratio: <span id="sharpeRatio">-</span></p>
        </div>
        <div id="chart"></div>
        <div id="riskReturnChart" style="margin-top: 40px; width: 100%; height: 400px;"></div>
        <div class="comparison-section">
            <h3>Comparison with S&P 500</h3>
        <div class="result">
            <p>Daily Performance:</p>
            <p>Average Portfolio Increase per Day: <span id="avgDailyReturn">-</span></p>
            <p>Daily Volatility: <span id="stdDev">-</span></p>
            <p>Trades per Day: <span id="tradesPerDay">-</span></p>
            
            <hr style="margin: 20px 0;">
            
            <p>Annual Projection:</p>
            <div class="input-group" style="margin-top: 10px;">
                <label for="tradingDays">Trading Days per Year:</label>
                <input type="number" id="tradingDays" value="252" min="1" max="365">
                <small style="display: block; color: #666;">Standard market year has 252 trading days</small>
            </div>
            <p>Estimated Annual Portfolio Increase: <span id="strategyReturn">-</span></p>
            <p>Total Trades Per Year: <span id="totalTrades">-</span></p>                <hr style="margin: 20px 0;">
                
                <p>S&P 500 Historical Average Returns:</p>
                <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
                    <tr>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Time Period</th>
                        <th style="text-align: right; padding: 8px; border-bottom: 1px solid #ddd;">Average Annual Return</th>
                        <th style="text-align: right; padding: 8px; border-bottom: 1px solid #ddd;">Your Strategy Relative Performance</th>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 10 Years (2015-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.7%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare10">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 20 Years (2005-2025)</td>
                        <td style="text-align: right; padding: 8px;">9.8%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare20">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 30 Years (1995-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.2%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare30">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Historical Average (1926-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.1%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compareHist">-</span></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="chart"></div>
    </div>
    <script>
    async function runSimulation() {
        const payload = {
            initialPortfolio: document.getElementById('initialPortfolio').value,
            risk: document.getElementById('riskValue').value,
            riskRewardRatio: document.getElementById('riskRewardValue').value,
            winProbability: document.getElementById('winProbabilityValue').value,
            riskFreeRate: document.getElementById('riskFreeRate').value,
            tradesPerDay: document.getElementById('tradesPerPeriod').value,
            tradingDays: document.getElementById('tradingDays').value,
            numSimulations: document.getElementById('simulations').value
        };

        const res = await fetch("/simulate", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        document.getElementById('averageResult').textContent = data.average;
        document.getElementById('bestCase').textContent = data.best;
        document.getElementById('worstCase').textContent = data.worst;
        document.getElementById('sharpeRatio').textContent = data.sharpe;
        document.getElementById('avgDailyReturn').textContent = data.average + "%";
        document.getElementById('stdDev').textContent = data.stdDev + "%";
        document.getElementById('strategyReturn').textContent = data.annualReturn + "%";

        // plot histogram
        const trace = {
            x: data.dailyResults,
            type: 'histogram',
            nbinsx: 30,
            name: 'Daily Returns Distribution',
            opacity: 0.7,
            marker: { color: 'blue' }
        };

        Plotly.newPlot('chart', [trace], {
            title: 'Distribution of Daily Returns',
            yaxis: { title: 'Frequency' },
            xaxis: { title: 'Daily Return (%)' },
            bargap: 0.05
        });

        // Fetch Sharpe vs Risk data
        const curveRes = await fetch("/risk_curve", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        const curveData = await curveRes.json();

        // Plot Sharpe Ratio vs. Risk
        const traceRisk = {
            x: curveData.risk,
            y: curveData.sharpe,
            type: 'scatter',
            mode: 'lines+markers',
            line: { width: 2 },
            marker: { size: 6 },
            name: 'Sharpe Ratio'
        };

        const layoutRisk = {
            title: 'Sharpe Ratio vs. Risk (%)',
            xaxis: { title: 'Risk (%)' },
            yaxis: { title: 'Sharpe Ratio' }
        };

        Plotly.newPlot('riskReturnChart', [traceRisk], layoutRisk);
    }
    </script>

</body>
</html>