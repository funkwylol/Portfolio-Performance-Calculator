<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Performance Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="range"] {
            padding: 0;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        #chart {
            margin-top: 20px;
            width: 100%;
            height: 300px;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Portfolio Performance Calculator</h1>
        <div class="input-group">
            <label for="initialPortfolio">Initial Portfolio Value:</label>
            <input type="number" id="initialPortfolio" value="100">
        </div>
        <div class="input-group">
            <label for="risk">Risk (%):</label>
            <input type="range" id="risk" min="1" max="20" value="5">
            <input type="number" id="riskValue" value="5" min="1" max="20">
        </div>
        <div class="input-group">
            <label for="riskRewardRatio">Risk/Reward Ratio:</label>
            <input type="range" id="riskRewardRatio" min="0.5" max="5" step="0.1" value="2">
            <input type="number" id="riskRewardValue" value="2" min="0.5" max="5" step="0.1">
        </div>
        <div class="input-group">
            <label for="winProbability">Win Probability (%):</label>
            <input type="range" id="winProbability" min="50" max="99" value="70">
            <input type="number" id="winProbabilityValue" value="70" min="50" max="99">
        </div>
        <div class="input-group">
            <label for="tradingStyle">Trading Style:</label>
            <select id="tradingStyle">
                <option value="day">Day Trading</option>
                <option value="swing">Swing Trading</option>
                <option value="position">Position Trading</option>
            </select>
        </div>
        <div class="input-group">
            <label for="tradesPerPeriod">Trades per Day:</label>
            <input type="number" id="tradesPerPeriod" value="5" min="1" max="50">
            <small style="display: block; color: #666;">Average number of trades you make per day</small>
        </div>
        <div class="input-group">
            <label for="tradingDays">Trading Days per Year:</label>
            <input type="number" id="tradingDays" value="252" min="1" max="365">
            <small style="display: block; color: #666;">Standard market year has 252 trading days</small>
        </div>
        <div class="input-group">
            <label for="simulations">Number of Simulations:</label>
            <input type="number" id="simulations" value="100" min="1" max="1000">
            <small style="display: block; color: #666;">More simulations = more accurate average</small>
        </div>
        <button onclick="runSimulation()">Calculate</button>
        <div class="result">
            <h3>Results:</h3>
            <p>Average Final Portfolio Value: <span id="averageResult">-</span></p>
            <p>Best Case: <span id="bestCase">-</span></p>
            <p>Worst Case: <span id="worstCase">-</span></p>
        </div>
        <div id="chart"></div>
        <div class="comparison-section">
            <h3>Comparison with S&P 500</h3>
            <div class="result">
                <p>Your Strategy:</p>
                <p>Annual Return: <span id="strategyReturn">-</span></p>
                <p>Average Daily Return: <span id="avgDailyReturn">-</span></p>
                <p>Daily Standard Deviation: <span id="stdDev">-</span></p>
                <p>Total Trades Per Year: <span id="totalTrades">-</span></p>
                
                <hr style="margin: 20px 0;">
                
                <p>S&P 500 Historical Average Returns:</p>
                <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
                    <tr>
                        <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Time Period</th>
                        <th style="text-align: right; padding: 8px; border-bottom: 1px solid #ddd;">Average Annual Return</th>
                        <th style="text-align: right; padding: 8px; border-bottom: 1px solid #ddd;">Your Strategy Relative Performance</th>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 10 Years (2015-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.7%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare10">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 20 Years (2005-2025)</td>
                        <td style="text-align: right; padding: 8px;">9.8%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare20">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Last 30 Years (1995-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.2%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compare30">-</span></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Historical Average (1926-2025)</td>
                        <td style="text-align: right; padding: 8px;">10.1%</td>
                        <td style="text-align: right; padding: 8px;"><span id="compareHist">-</span></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="chart"></div>
    </div>
    <script>
        // Sync range and number inputs
        document.getElementById('risk').addEventListener('input', function(e) {
            document.getElementById('riskValue').value = e.target.value;
        });
        document.getElementById('riskValue').addEventListener('input', function(e) {
            document.getElementById('risk').value = e.target.value;
        });
        document.getElementById('riskRewardRatio').addEventListener('input', function(e) {
            document.getElementById('riskRewardValue').value = e.target.value;
        });
        document.getElementById('riskRewardValue').addEventListener('input', function(e) {
            document.getElementById('riskRewardRatio').value = e.target.value;
        });
        document.getElementById('winProbability').addEventListener('input', function(e) {
            document.getElementById('winProbabilityValue').value = e.target.value;
        });
        document.getElementById('winProbabilityValue').addEventListener('input', function(e) {
            document.getElementById('winProbability').value = e.target.value;
        });

        function runSimulation() {
            const initialPortfolio = parseFloat(document.getElementById('initialPortfolio').value);
            const risk = parseFloat(document.getElementById('riskValue').value) / 100;
            const riskRewardRatio = parseFloat(document.getElementById('riskRewardValue').value);
            const tradesPerDay = parseInt(document.getElementById('tradesPerPeriod').value);
            const tradingDaysPerYear = parseInt(document.getElementById('tradingDays').value);
            const numSimulations = parseInt(document.getElementById('simulations').value);
            const winProbability = parseFloat(document.getElementById('winProbabilityValue').value) / 100;
            const tradingStyle = document.getElementById('tradingStyle').value;

            // Calculate total trades per year
            const totalTradesPerYear = tradesPerDay * tradingDaysPerYear;
            
            let allResults = [];
            let dailyResults = [];
            let allPaths = [];

            // Run multiple simulations for a full year
            for (let sim = 0; sim < numSimulations; sim++) {
                let portfolio = initialPortfolio;
                let path = [portfolio];
                let dailyPath = [];
                
                // Simulate each trading day
                for (let day = 0; day < tradingDaysPerYear; day++) {
                    let startOfDayPortfolio = portfolio;
                    
                    // Simulate trades for this day
                    for (let trade = 0; trade < tradesPerDay; trade++) {
                        const randomValue = Math.random();
                        if (randomValue < winProbability) {  // User-defined chance of success
                            portfolio += (portfolio * (riskRewardRatio * risk));
                        } else {
                            portfolio -= (portfolio * risk);
                        }
                    }
                    
                    // Record daily result
                    dailyPath.push(((portfolio - startOfDayPortfolio) / startOfDayPortfolio) * 100);
                    path.push(portfolio);
                }
                
                allResults.push(portfolio);
                allPaths.push(path);
                dailyResults.push(dailyPath);
            }

            // Calculate statistics
            const average = allResults.reduce((a, b) => a + b, 0) / allResults.length;
            const best = Math.max(...allResults);
            const worst = Math.min(...allResults);

            // Calculate returns
            const totalReturn = ((average - initialPortfolio) / initialPortfolio) * 100;
            const annualizedReturn = totalReturn; // This is already annual since we simulated a full year

            // Calculate average daily return and standard deviation
            const allDailyReturns = dailyResults.flat();
            const avgDailyReturn = allDailyReturns.reduce((a, b) => a + b, 0) / allDailyReturns.length;
            const stdDev = Math.sqrt(
                allDailyReturns.reduce((sq, n) => sq + Math.pow(n - avgDailyReturn, 2), 0) / (allDailyReturns.length - 1)
            );

            // Update results
            document.getElementById('averageResult').textContent = average.toFixed(2);
            document.getElementById('bestCase').textContent = best.toFixed(2);
            document.getElementById('worstCase').textContent = worst.toFixed(2);
            
            // Update strategy returns
            document.getElementById('strategyReturn').textContent = annualizedReturn.toFixed(2) + '%';
            document.getElementById('avgDailyReturn').textContent = avgDailyReturn.toFixed(2) + '%';
            document.getElementById('stdDev').textContent = stdDev.toFixed(2) + '%';
            document.getElementById('totalTrades').textContent = totalTradesPerYear;

            // Compare with S&P 500
            const sp500Returns = {
                '10year': 10.7,
                '20year': 9.8,
                '30year': 10.2,
                'historical': 10.1
            };

            document.getElementById('compare10').textContent = 
                `${(annualizedReturn - sp500Returns['10year']).toFixed(2)}% ${annualizedReturn > sp500Returns['10year'] ? 'ðŸ“ˆ' : 'ðŸ“‰'}`;
            document.getElementById('compare20').textContent = 
                `${(annualizedReturn - sp500Returns['20year']).toFixed(2)}% ${annualizedReturn > sp500Returns['20year'] ? 'ðŸ“ˆ' : 'ðŸ“‰'}`;
            document.getElementById('compare30').textContent = 
                `${(annualizedReturn - sp500Returns['30year']).toFixed(2)}% ${annualizedReturn > sp500Returns['30year'] ? 'ðŸ“ˆ' : 'ðŸ“‰'}`;
            document.getElementById('compareHist').textContent = 
                `${(annualizedReturn - sp500Returns['historical']).toFixed(2)}% ${annualizedReturn > sp500Returns['historical'] ? 'ðŸ“ˆ' : 'ðŸ“‰'}`;

            // Create plot
            const traces = allPaths.map((path, i) => ({
                y: path,
                type: 'scatter',
                mode: 'lines',
                opacity: 0.1,
                line: { color: 'blue' },
                showlegend: false
            }));

            // Add average line
            const avgPath = Array(iterations + 1).fill(0);
            for (let i = 0; i <= iterations; i++) {
                avgPath[i] = allPaths.reduce((sum, path) => sum + path[i], 0) / allPaths.length;
            }

            traces.push({
                y: avgPath,
                type: 'scatter',
                mode: 'lines',
                line: { color: 'red', width: 2 },
                name: 'Average'
            });

            const layout = {
                title: 'Portfolio Value Over Time',
                yaxis: { title: 'Portfolio Value' },
                xaxis: { title: 'Iteration' },
                showlegend: true
            };

            Plotly.newPlot('chart', traces, layout);
        }

        // Run initial simulation
        runSimulation();
    </script>
</body>
</html>